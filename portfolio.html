<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Style_CSS/main_1.css">
    <link rel="stylesheet" href="Style_CSS/header_1.css">
    <link rel="stylesheet" href="Style_CSS/footer.css">
    <title>Art Line</title>
</head>
<body>
    <header>
        <div>
            <a href="/index.html">
                <img src="src/logo.png" alt="Art Line Renovierung Logo" class="articleImg">
            </a>
        </div>
        <div class="head-center">
            <nav class="headerButtonBlock">
                <a href="/index.html#kontakt" class="headerButon">Kontakt</a>
                <a href="/preise.html" class="headerButon">Preisliste</a>
                <a href="/portfolio.html" class="headerButon">Portfolio</a>
                <a href="/warum-wir.html" class="headerButon">Warum Wir?</a>
            </nav> 
        </div>
    </header>
    <main>
        <div class="photo-block" id="photoBlock"></div>

        <!-- Loading spinner and error message -->
        <div id="photo-loading" class="photo-loading" aria-hidden="true" style="display:none; text-align:center; padding:1rem;">
            <div class="spinner" aria-hidden="true" style="display:inline-block; width:36px; height:36px; border:4px solid #ccc; border-top-color:#333; border-radius:50%; animation:spin 1s linear infinite;"></div>
            <div style="margin-top:.5rem;">Bilder werden geladen&hellip;</div>
        </div>
        <div id="photo-error" class="photo-error" aria-live="polite" style="display:none; text-align:center; color:#c00; padding:1rem;">
            Fehler beim Laden der Galerie. Bitte Seite neu laden oder sp&auml;ter versuchen.
        </div>

        <div class="zoom-overlay"></div>
        <div class="zoom-navigation">
            <button id="prev-photo">&lt;</button>
            <button id="next-photo">&gt;</button>
        </div>
    </main>
    <footer>
        &copy; 2025 Artline Renovierung &nbsp; | &nbsp; <a href="/impressum.html">Impressum</a>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const photoBlock = document.getElementById('photoBlock');
            const prevButton = document.getElementById('prev-photo');
            const nextButton = document.getElementById('next-photo');
            const zoomOverlay = document.querySelector('.zoom-overlay');
            const zoomNavigation = document.querySelector('.zoom-navigation');
            let photoImages = [];
            let currentlyZoomedIndex = -1;
            // swipe
            let touchStartX = 0;
            let touchEndX = 0;
            const minSwipeDistance = 50;

            function loadImages() {
                const loadingEl = document.getElementById('photo-loading');
                const errorEl = document.getElementById('photo-error');
                loadingEl.style.display = 'block';
                loadingEl.setAttribute('aria-hidden', 'false');
                errorEl.style.display = 'none';

                fetch('photos/list.json')
                    .then(response => {
                        if (!response.ok) throw new Error('Network response was not ok');
                        return response.json();
                    })
                    .then(imageList => {
                        if (!Array.isArray(imageList) || imageList.length === 0) {
                            throw new Error('No images found in manifest');
                        }
                        imageList.forEach(imagePath => {
                            const img = document.createElement('img');
                            img.src = imagePath;
                            img.alt = 'Projekt photos';
                            img.classList.add('photoImg');
                            img.loading = 'lazy';
                            img.onload = function() { this.classList.add('loaded'); };
                            photoBlock.appendChild(img);
                        });
                        photoImages = document.querySelectorAll('.photoImg');
                        attachEventListeners();
                        updateNavigationButtons();
                        updateOverlayVisibility();
                    })
                    .catch(err => {
                        console.error('Failed to load photos/list.json:', err);
                        const errorEl2 = document.getElementById('photo-error');
                        errorEl2.textContent = 'Fehler beim Laden der Galerie. Bitte Seite neu laden oder spÃ¤ter versuchen.';
                        errorEl2.style.display = 'block';
                    })
                    .finally(() => {
                        loadingEl.style.display = 'none';
                        loadingEl.setAttribute('aria-hidden', 'true');
                    });
            }

            function updateNavigationButtons() {
                if (prevButton && nextButton) {
                    const noSelection = (currentlyZoomedIndex === -1);
                    if (noSelection || currentlyZoomedIndex <= 0) {
                        prevButton.disabled = true;
                        prevButton.classList.add('disabled-button');
                    } else {
                        prevButton.disabled = false;
                        prevButton.classList.remove('disabled-button');
                    }

                    if (noSelection || currentlyZoomedIndex >= photoImages.length - 1) {
                        nextButton.disabled = true;
                        nextButton.classList.add('disabled-button');
                    } else {
                        nextButton.disabled = false;
                        nextButton.classList.remove('disabled-button');
                    }

                    zoomNavigation.style.visibility = !noSelection ? 'visible' : 'hidden';
                    prevButton.style.opacity = !noSelection ? '1' : '0';
                    nextButton.style.opacity = !noSelection ? '1' : '0';
                }
            }

            function updateOverlayVisibility() {
                zoomOverlay.style.visibility = currentlyZoomedIndex !== -1 ? 'visible' : 'hidden';
                zoomOverlay.style.opacity = currentlyZoomedIndex !== -1 ? '1' : '0';
            }

            function showNextPhoto() {
                if (currentlyZoomedIndex < photoImages.length - 1) {
                    photoImages[currentlyZoomedIndex].classList.remove('zoomed');
                    currentlyZoomedIndex++;
                    photoImages[currentlyZoomedIndex].classList.add('zoomed');
                    updateNavigationButtons();
                    updateOverlayVisibility();
                }
            }

            function showPrevPhoto() {
                if (currentlyZoomedIndex > 0) {
                    photoImages[currentlyZoomedIndex].classList.remove('zoomed');
                    currentlyZoomedIndex--;
                    photoImages[currentlyZoomedIndex].classList.add('zoomed');
                    updateNavigationButtons();
                    updateOverlayVisibility();
                }
            }

            function attachEventListeners() {
                photoImages.forEach((img, index) => {
                    img.addEventListener('click', function() {
                        photoImages.forEach(innerImg => innerImg.classList.remove('zoomed'));
                        currentlyZoomedIndex = index;
                        this.classList.add('zoomed');
                        updateNavigationButtons();
                        updateOverlayVisibility();
                    });
                });

                if (prevButton) {
                    prevButton.addEventListener('click', function(e) {
                        e.preventDefault();
                        if (currentlyZoomedIndex === -1) {
                            if (photoImages.length > 0) {
                                currentlyZoomedIndex = 0;
                                photoImages[currentlyZoomedIndex].classList.add('zoomed');
                            }
                        } else {
                            showPrevPhoto();
                        }
                        updateNavigationButtons();
                        updateOverlayVisibility();
                    });
                }

                if (nextButton) {
                    nextButton.addEventListener('click', function(e) {
                        e.preventDefault();
                        if (currentlyZoomedIndex === -1) {
                            if (photoImages.length > 0) {
                                currentlyZoomedIndex = 0;
                                photoImages[currentlyZoomedIndex].classList.add('zoomed');
                            }
                        } else {
                            showNextPhoto();
                        }
                        updateNavigationButtons();
                        updateOverlayVisibility();
                    });
                }

                document.addEventListener('click', function(event) {
                    if (currentlyZoomedIndex !== -1 && !event.target.classList.contains('photoImg') && !event.target.closest('.zoom-navigation')) {
                        photoImages[currentlyZoomedIndex].classList.remove('zoomed');
                        currentlyZoomedIndex = -1;
                        updateNavigationButtons();
                        updateOverlayVisibility();
                    }
                });

                document.addEventListener('keydown', function(event) {
                    if (event.key === 'Escape' && currentlyZoomedIndex !== -1) {
                        photoImages[currentlyZoomedIndex].classList.remove('zoomed');
                        currentlyZoomedIndex = -1;
                        updateNavigationButtons();
                        updateOverlayVisibility();
                    } else if (currentlyZoomedIndex !== -1) {
                        if (event.key === 'ArrowLeft') {
                            showPrevPhoto();
                        } else if (event.key === 'ArrowRight') {
                            showNextPhoto();
                        }
                    }
                });

                // swipe support
                document.addEventListener('touchstart', function(e) {
                    touchStartX = e.changedTouches[0].screenX;
                });
                document.addEventListener('touchend', function(e) {
                    touchEndX = e.changedTouches[0].screenX;
                    const delta = touchEndX - touchStartX;
                    if (currentlyZoomedIndex !== -1 && Math.abs(delta) > minSwipeDistance) {
                        if (delta < 0) { showNextPhoto(); }
                        if (delta > 0) { showPrevPhoto(); }
                    }
                });
            }

            loadImages();
        });
    </script>
</body>
</html>
